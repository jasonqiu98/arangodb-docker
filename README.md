# arangodb-docker

An environment to build a simple ArangoDB cluster with one agency node, two coordinator nodes and three DBServer nodes. Borrowed and adapted based on <https://github.com/Korov/Docker/blob/master/arangodb/cluster/docker-compose.yaml>.

## Access the default database through a coordinator in an ArangoDB Cluster

1. Make sure the Docker daemon is running on your machine
2. If `logs` and `nodes` folders already exist and YOU DON'T NEED THEM ANYMORE, remember to remove them by `sudo rm -rf nodes logs`; if you need them, back them up somewhere else before removing them
3. Up the docker compose `docker compose up` (or in the backend: `docker compose up -d`)
4. Open a new terminal and enter the `test` container by `docker exec -it arango-test sh`
5. Connect to the default database `_system` via a coordinator, say `coordinator1` by
   - `arangosh --server.endpoint tcp://coordinator1:8529 --server.username root --server.password ""`

## Import an extract of LDBC and then access the database

1. Make sure the Docker daemon is running on your machine
2. If `logs` and `nodes` folders already exist and YOU DON'T NEED THEM ANYMORE,, remember to remove them by `sudo rm -rf nodes logs`; if you need them, back them up somewhere else before removing them
3. Up the docker compose `docker compose up` (or in the backend: `docker compose up -d`)
4. Open a new terminal and enter the `test` container by `docker exec -it arango-test sh`
5. Run the script `sh /resources/ldbc_extract/arangoimport.sh` to import an extract of LDBC
6. Connect to another database, say LDBC database `ldbc_snb_sf0001` via a coordinator, say `coordinator1` by
   - `arangosh --server.endpoint tcp://coordinator1:8529 --server.username root --server.password "" --server.database "ldbc_snb_sf0001"`

## Stop and remove the cluster

- Stop
  - `docker compose stop` to stop all the services
- Remove
  - `docker compose down -v` or `docker compose down --volumes` to remove all the containers, networks and volumes generated by the `docker-compose.yml` file
  - Run `sudo rm -rf nodes logs` to delete relevant records/logs (if you don't need them for analysis any more)

## Some hints

1. Run `sudo chmod 777 logs/*/*.log` before accessing the log files on your local machine
2. Some example queries

```sql
db.Person.removeByKeys(["30786325580104"])
db._query('FOR p IN Person FILTER p.birthday_day > 18 RETURN p._key')
```

3. In `queries.log` files, code `[11160]` means the start of a query and code `[f5cee]` means the end.
